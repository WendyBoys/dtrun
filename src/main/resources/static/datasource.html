<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Filedash - File Manager Dashboard</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="assets/media/image/favicon.png" />

    <!-- Main css -->
    <link rel="stylesheet" href="vendors/bundle.css" type="text/css">

    <link href="css/css2.css" rel="stylesheet">

    <!-- Prism -->
    <link rel="stylesheet" href="vendors/prism/prism.css" type="text/css">


    <!-- App css -->
    <link rel="stylesheet" href="assets/css/app.css" type="text/css">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- Preloader -->
<div class="preloader">
    <div class="preloader-icon"></div>
</div>
<!-- ./ Preloader -->

<!-- Layout wrapper -->
<div class="layout-wrapper">
    <!-- Header -->
    <div id="header"></div>


    <div class="content-wrapper">

        <div id="nav"></div>


        <!-- Content body -->
        <div class="content-body">

            <!-- 数据源创建页面 -->
            <div id="createdts" class="content" style="display: none;">
                <div class="page-header d-flex justify-content-between">
                    <h2>创建数据源</h2>
                    <a href="#" class="components-toggler">
                        <i class="ti-menu"></i>
                    </a>
                </div>

                <div class="row">

                    <div class="col-xl-7 components-sidebar">
                        <form id="dtsform"  onsubmit="return false" class="needs-validation" novalidate>
                            <label for="dataSourceName">数据源名称</label>
                            <input type="text" class="form-control" id="dataSourceName" placeholder="请输入数据源名称" required>
                            <div class="valid-feedback">
                            </div>
                            <div class="invalid-feedback">
                                请输入数据源名称
                            </div>
                            <label for="dataSourceType">数据源类型</label>
                            <select class="custom-select" id="dataSourceType" required>
                                <option value="cos">腾讯云COS</option>
                                <option value="oss">阿里云OSS</option>
                                <option value="bos">百度云BOS</option>
                                <option value="obs">华为云OBS</option>
                            </select>
                            <label for="accessKey">AccessKey</label>
                            <input type="text" class="form-control" id="accessKey" placeholder="请输入AccessKey" required>
                            <div class="valid-feedback">
                            </div>
                            <div class="invalid-feedback">
                                请输入AccessKey
                            </div>
                            <label for="accessSecret">AccessSecret</label>
                            <input type="text" class="form-control" id="accessSecret" placeholder="请输入AccessSecret" required>
                            <div class="valid-feedback">
                            </div>
                            <div class="invalid-feedback">
                                请输入AccessSecret
                            </div>
                            <label for="region">地域</label>
                            <input type="text" class="form-control" id="region" placeholder="请输入地域" required>
                            <div class="valid-feedback">
                            </div>
                            <div class="invalid-feedback">
                                请输入地域
                            </div>

                            <div style="margin-top: 20px;">
                                <button class="btn btn-primary" id="submit">确定</button>
                                <button type="submit" style="margin-left: 20px;" class="btn btn-success" id="test">测试</button>

                            </div>
                        </form>

                    </div>
                    <div class="col-xl-3"></div>
                </div>
            </div>

            <!-- 数据源展示列表 -->
            <div id="listdts" class="content">
                <div class="row" style="margin-bottom: 10px;">
                    <div class="col-xl-12 ">
                        <button id="create" class="btn btn-primary pull-right" id="submit">创建</button>
                    </div>
                </div>



                <div class="row">
                    <div class="col-xl-12 components-sidebar">
                        <table class="table">
                            <thead>
                            <tr>
                                <th scope="col">序号</th>
                                <th scope="col">数据源名称</th>
                                <th scope="col">数据源类型</th>
                                <th scope="col">创建时间</th>
                                <th scope="col">操作</th>
                            </tr>
                            </thead>
                            <tbody id="dtsource">
                            </tbody>
                        </table>



                    </div>


                    <!-- Sidebar group -->
                    <div class="sidebar-group d-print-none">
                        <!-- Sidebar - Storage -->
                        <div class="sidebar primary-sidebar show" id="storage">
                            <div class="sidebar-header">
                                <h4>Storage Overview</h4>
                            </div>
                            <div class="sidebar-content">
                                <div id="justgage_five" class="mb-3"></div>
                                <div>
                                    <div class="list-group list-group-flush mb-3">
                                        <a href="#" class="list-group-item px-0 d-flex align-items-center">
                                            <div class="mr-3">
                                                <figure class="avatar">
															<span class="avatar-title bg-primary-bright text-primary rounded">
																<i class="ti-image"></i>
															</span>
                                                </figure>
                                            </div>
                                            <div class="flex-grow-1">
                                                <p class="mb-0">Images</p>
                                                <span class="small text-muted">259 Files</span>
                                            </div>
                                            <div>
                                                <h5 class="text-primary">15.7 GB</h5>
                                            </div>
                                        </a>
                                        <a href="#" class="list-group-item px-0 d-flex align-items-center">
                                            <div class="mr-3">
                                                <figure class="avatar">
															<span class="avatar-title bg-primary-bright text-primary rounded">
																<i class="ti-control-play"></i>
															</span>
                                                </figure>
                                            </div>
                                            <div class="flex-grow-1">
                                                <p class="mb-0">Videos</p>
                                                <span class="small text-muted">8 Files</span>
                                            </div>
                                            <div>
                                                <h5 class="text-primary">20 GB</h5>
                                            </div>
                                        </a>
                                        <a href="#" class="list-group-item px-0 d-flex align-items-center">
                                            <div class="mr-3">
                                                <figure class="avatar">
															<span class="avatar-title bg-primary-bright text-primary rounded">
																<i class="ti-files"></i>
															</span>
                                                </figure>
                                            </div>
                                            <div class="flex-grow-1">
                                                <p class="mb-0">Documents</p>
                                                <span class="small text-muted">46 Files</span>
                                            </div>
                                            <div>
                                                <h5 class="text-primary">10.5 GB</h5>
                                            </div>
                                        </a>
                                        <a href="#" class="list-group-item px-0 d-flex align-items-center">
                                            <div class="mr-3">
                                                <figure class="avatar">
															<span class="avatar-title bg-primary-bright text-primary rounded">
																<i class="ti-file"></i>
															</span>
                                                </figure>
                                            </div>
                                            <div class="flex-grow-1">
                                                <p class="mb-0">Other Files</p>
                                                <span class="small text-muted">50 Files</span>
                                            </div>
                                            <div>
                                                <h5 class="text-primary">2.8 GB</h5>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div class="card border shadow-none">
                                    <div class="card-body text-center">
                                        <img class="img-fluid mb-3" src="assets/media/svg/upgrade.svg" alt="upgrade">
                                        <h5>Get an Upgrade</h5>
                                        <p class="text-muted">Get additional 500 GB space for your documents and files. Unlock now
                                            for more space.</p>
                                        <button class="btn btn-primary">Upgrade</button>
                                    </div>
                                </div>
                            </div>
                            <div class="sidebar-footer">
                                <button class="btn btn-lg btn-block btn-outline-primary">
                                    <i class="fa fa-cloud-upload mr-3"></i> Upload
                                </button>
                            </div>
                        </div>
                        <!-- ./ Sidebar - Storage -->

                        <!-- Sidebar - File info -->
                        <div class="sidebar" id="view-detail">
                            <div class="sidebar-header">
                                <h4>View Detail</h4>
                                <a href="#" class="btn btn-light btn-floating sidebar-close-btn">
                                    <i class="ti-angle-right"></i>
                                </a>
                            </div>
                            <div class="sidebar-content">
                                <figure class="avatar mb-4">
											<span class="avatar-title bg-info-bright text-info rounded-pill">
												<i class="ti-file"></i>
											</span>
                                </figure>
                                <div class="row mb-3">
                                    <div class="col-md-5">File name:</div>
                                    <div class="col-md-7"><a href="#" class="link-1">Meeting-notes.doc</a></div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-5">File type:</div>
                                    <div class="col-md-7">Word File</div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-5">File size:</div>
                                    <div class="col-md-7">22 KB</div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-5">Created:</div>
                                    <div class="col-md-7">Monday, July 02, 2020 9:34am</div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-5">Modified:</div>
                                    <div class="col-md-7 text-success">Monday, July 02, 2020 9:34am</div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-5">Accessed:</div>
                                    <div class="col-md-7">Monday, July 03, 2020 10:22am</div>
                                </div>
                            </div>
                            <div class="sidebar-footer">
                                <button class="btn btn-lg btn-block btn-primary">
                                    <i class="ti-share mr-3"></i> Share
                                </button>
                            </div>
                        </div>
                        <!-- ./ Sidebar - file info -->

                        <!-- Sidebar - Settings -->
                        <div class="sidebar" id="settings">
                            <div class="sidebar-header">
                                <h4>Settings</h4>
                                <a href="#" class="btn btn-light btn-floating sidebar-close-btn">
                                    <i class="ti-angle-right"></i>
                                </a>
                            </div>
                            <div class="sidebar-content">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item pl-0 pr-0">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="customSwitch1" checked>
                                            <label class="custom-control-label" for="customSwitch1">Allow notifications.</label>
                                        </div>
                                    </li>
                                    <li class="list-group-item pl-0 pr-0">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="customSwitch2">
                                            <label class="custom-control-label" for="customSwitch2">Hide user requests</label>
                                        </div>
                                    </li>
                                    <li class="list-group-item pl-0 pr-0">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="customSwitch3" checked>
                                            <label class="custom-control-label" for="customSwitch3">Speed up demands</label>
                                        </div>
                                    </li>
                                    <li class="list-group-item pl-0 pr-0">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="customSwitch4" checked>
                                            <label class="custom-control-label" for="customSwitch4">Hide menus</label>
                                        </div>
                                    </li>
                                    <li class="list-group-item pl-0 pr-0">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="customSwitch5">
                                            <label class="custom-control-label" for="customSwitch5">Remember next visits</label>
                                        </div>
                                    </li>
                                    <li class="list-group-item pl-0 pr-0">
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="customSwitch6">
                                            <label class="custom-control-label" for="customSwitch6">Enable report
                                                generation.</label>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- ./ Sidebar - Settings -->
                    </div>
                    <!-- ./ Sidebar group -->
                </div>
                <!-- ./ Content wrapper -->
            </div>
            <div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">提示</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div id="resultMessgae" style="font-size: 20px;font-weight: 900;" class="modal-body">

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">确定</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ./ Layout wrapper -->

            <!-- Main scripts -->
            <script src="vendors/bundle.js"></script>
            <script src="js/raphael-min.js"></script>
            <script src="js/justgage.min.js"></script>

            <!-- Prism -->
            <script src="vendors/prism/prism.js"></script>
            <script src="https://cdn.jsdelivr.net/gh/WendyBoys/oss/js/axios.min.js"></script>

            <!-- App scripts -->
            <script src="assets/js/app.js"></script>
</body>
</html>

<script>
    $("#header").load("header.html");
    $("#nav").load("nav.html");
    fentch();
    function fentch() {
        var $table = $("#dtsource");
        $table.html('');
        axios.get('http://localhost/dtsource/findAll?userId=1').then((response) => {
            var result = response.data.message;
            var data = response.data.data;
            var index = 1;
            if (result == 'Success') {
                for (i = 0; i < data.length; i++) {
                    var $tr = $("<tr>" +
                        "<td>" + index++ + "</td>" +
                        "<td>" + data[i].dtsourcename + "</td>" +
                        "<td>" + data[i].dtSourceType + "</td>" +
                        "<td>" + data[i].createTime + "</td>" +
                        "<td><a href='javascript:testdts(" + data[i].id +
                        ")' style='color: #007bff;'>测试</a> &nbsp;<a href='javascript:deletedts(" + data[i].id +
                        ")' style='color: #007bff;'>删除</a></td>" +
                        "</tr>");
                    $table.append($tr);
                }

            } else {

            }
        });

    }


    function testdts(id) {
        //发测试请求
    }

    function deletedts(id) {

        //发删除请求
    }

    $('#create').click(function() {
        $("#listdts").css('display', 'none');
        $("#createdts").css('display', '');
    });


    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();

    $('#submit').click(function() {
        var dataSourceName = $('#dataSourceName').val();
        var dataSourceType = $('#dataSourceType').val();
        var accessKey = $('#accessKey').val();
        var accessSecret = $('#accessSecret').val();
        var region = $('#region').val();
        if (dataSourceName == undefined || dataSourceName.trim() == '') {
            return true;
        } else if (dataSourceType == undefined || dataSourceType.trim() == '') {
            return true;
        } else if (accessKey == undefined || accessKey.trim() == '') {
            return true;
        } else if (accessSecret == undefined || accessSecret.trim() == '') {
            return true;
        } else if (region == undefined || region.trim() == '') {
            return true;
        }
        axios.post('http://localhost/dtsource/create', {
            dataSourceName: dataSourceName,
            dataSourceType: dataSourceType,
            secretId: accessKey,
            secretKey: accessSecret,
            region: region,
        }).then((response) => {
            var result = response.data.message;
            if (result == 'Success') {
                $("#listdts").css('display', '');
                $("#createdts").css('display', 'none');
                window.location.href='datasource.html'
            } else {
                alert('创建失败');
            }
        });

    });


    $('#test').click(function() {
        var dataSourceName = $('#dataSourceName').val();
        var dataSourceType = $('#dataSourceType').val();
        var accessKey = $('#accessKey').val();
        var accessSecret = $('#accessSecret').val();
        var region = $('#region').val();

        if (dataSourceName == undefined || dataSourceName.trim() == '') {
            return true;
        } else if (dataSourceType == undefined || dataSourceType.trim() == '') {
            return true;
        } else if (accessKey == undefined || accessKey.trim() == '') {
            return true;
        } else if (accessSecret == undefined || accessSecret.trim() == '') {
            return true;
        } else if (region == undefined || region.trim() == '') {
            return true;
        }
        axios.post('http://localhost/dtsource/connection', {
            secretId: accessKey,
            secretKey: accessSecret,
            region: region,
        }).then((response) => {
            var result = response.data.message;
            if (result == 'Success') {
                $('#resultMessgae').text('连接成功 └(^o^)┘').css({
                    color: 'green'
                });
                $('#resultModal').modal('show');
            } else {
                $('#resultMessgae').text('连接失败X﹏X').css({
                    color: 'red'
                })
                $('#resultModal').modal('show');
            }
        });
    })
</script>
